<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EasyWorld Co. Op - Blog</title>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="..." crossorigin="anonymous">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/blog.css') }}">
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="EasyWorld Co. Op Logo" width="40" height="40" class="me-2">
                <span class="brand-name gradient-heading">EasyWorld Co. Op</span>
            </a>
            <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" id="navToggler">
              <span class="toggler-icon top-bar"></span>
              <span class="toggler-icon middle-bar"></span>
              <span class="toggler-icon bottom-bar"></span>
            </button>

        
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('overview') }}"><i class="fas fa-info-circle me-1"></i> Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('ventures') }}"><i class="fas fa-cogs me-1"></i> Ventures</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}#community"><i class="fas fa-users me-1"></i> Community & Collaboration</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact"><i class="fas fa-envelope me-1"></i> Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('blog') }}"><i class="fas fa-blog me-1"></i> Blog</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Blog Section -->
    <div class="container">
      <div class="blog-header">
        <h1><i class="fas fa-pen-nib me-2"></i> EasyWorld Blog</h1>
        <p>Ideas, stories & updates from EasyWorld Co. Op</p>
      </div>

      <!-- Blog Grid -->
      <div class="blog-container" id="blogPosts">
        <!-- Blog posts will be injected here by JavaScript -->
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p>&copy; 2025 EasyWorld Co. Op. All rights reserved.</p>
    </footer>
    <!-- Bootstrap 5 Bundle with Popper.js (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
    const toggler = document.getElementById('navToggler');
    toggler.addEventListener('click', function () {
        this.classList.toggle('open');
     });

      // Fetch blog posts from API
      async function loadBlogs() {
        try {
          const res = await fetch("/api/get_blogs");
          const posts = await res.json();
          const container = document.getElementById("blogPosts");

          if (posts.length === 0) {
            container.innerHTML = `<p class="text-center text-muted">No blog posts yet. Check back soon!</p>`;
            return;
          }
                  
     container.innerHTML = posts.map(p => `
       <div class="blog-card" id="blog-${p.id}">
         ${p.image_url ? `<img src="${p.image_url}" alt="${p.title}">` : ""}
         <div class="blog-card-body position-relative">
          <h3 class="blog-card-title">${p.title}</h3>
            <p class="blog-card-text">${p.content.substring(0, 150)}...</p>
            <p class="blog-meta">
              <i class="fas fa-user"></i> ${p.author} • 
              <i class="fas fa-clock"></i> ${p.created_at}
            </p>

      <div class="share-section position-relative">
        <button class="share-btn" onclick="shareBlog('${p.id}', this)">
          <i class="fas fa-share-alt"></i> Share
        </button>
        <span class="tooltip">Copied!</span>
      </div>
    </div>
  </div>
  `).join("");

      loadBlogs();

       // ⚙️ Smart image-fit function
          function applySmartImageFit() {
            const images = document.querySelectorAll(".blog-card img");
            images.forEach(img => {
              img.addEventListener("load", () => {
                if (img.naturalHeight > img.naturalWidth) {
                img.style.objectFit = "contain";
                img.style.maxHeight = "400px";} 
                else {
                img.style.objectFit = "cover";}
              });
            });
          }

          // Auto-scroll to a blog if URL has a hash (e.g. #blog-3)
            window.addEventListener("load", () => {
              const hash = window.location.hash;
              if (hash) {
              const el = document.querySelector(hash);
                if (el) {
                  el.scrollIntoView({ behavior: "smooth", block: "start" });
                }
              }
            });
          // Share / Copy Function
        function shareBlog(id, btn) {
          const url = `${window.location.origin}/blog#blog-${id}`;
          const tooltip = btn.nextElementSibling;

        if (navigator.share) {
          navigator.share({ title: "EasyWorld Blog", text: "Check this out!", url });
        } else {
          navigator.clipboard.writeText(url).then(() => {
            tooltip.classList.add("show-tooltip");
            setTimeout(() => tooltip.classList.remove("show-tooltip"), 1500);
          });
        }
    </script>
  </body>
</html>
